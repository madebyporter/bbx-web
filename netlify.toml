[build]
  command = "npm run build"
  
[build.environment]
  NODE_VERSION = "20.19.0"

[dev]
  targetPort = 3000
  port = 8888

# Cache audio files from Supabase aggressively
[[headers]]
  for = "https://*.supabase.co/storage/v1/object/public/sounds/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"
    
# Cache static assets
[[headers]]
  for = "/img/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

# Note: Content-Type headers removed for dev mode compatibility
# Vite dev server handles MIME types automatically
# These headers would interfere with Vite's module serving in development
# Cache-Control headers are kept for production builds
[[headers]]
  for = "/*.js"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*.css"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

# SPA fallback - redirect only non-file routes to index.html
# Note: In dev mode, Nuxt handles routing, so this mainly applies to production
# TEMPORARILY COMMENTED OUT TO TEST IF IT'S CAUSING MIME TYPE ISSUES IN DEV MODE
# This should come AFTER the /_nuxt/* rule so it doesn't catch Nuxt assets
# [[redirects]]
#   from = "/*"
#   to = "/index.html"
#   status = 200
#   force = false
#   # Exclude static assets - they should be served directly
#   # Netlify will serve files before applying redirects, but we set force=false to be safe

# Function configuration for download-sample
[functions."download-sample"]
  timeout = 60  # 60 seconds for audio processing 